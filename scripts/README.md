# Build Scripts Guide

This directory contains automation scripts for building, packaging, and developing the Smart Workflow Obsidian plugin.

## Quick Start

### First-time Setup

```bash
# 1. Install dependencies
pnpm i

# 2. Build Rust binary (only needed once)
pnpm build:rust

# 3. Build and install to Obsidian
pnpm install:dev
```

### Daily Development Workflow

```bash
# After modifying code, just run (automatically executes pnpm build)
pnpm install:dev

# Then in Obsidian:
# â†’ Settings â†’ Community plugins â†’ Click "Reload" button on Smart Workflow title
```

> ðŸ’¡ **Tip**: `pnpm install:dev` includes automatic build, no need to run `pnpm build` manually

---

## Script Reference

### build-rust.js - Build Rust Binary

```bash
# Auto-detect current platform and build
node scripts/build-rust.js

# Or via pnpm
pnpm build:rust

# Skip installing build target
node scripts/build-rust.js --skip-install
```

**Output**: `binaries/pty-server-{platform}{ext}` and corresponding `.sha256` file

> **Note**: Local builds only support the current platform. Cross-compilation requires GitHub Actions.

---

### package-plugin.js - Package Plugin

```bash
# Auto-detect current platform and package
pnpm package

# Package and create ZIP
pnpm package -- --zip
```

**Output**: `plugin-package/`

> **Note**: Local packaging only includes the current platform binary. Full release packages are generated by GitHub Actions.

---

### install-dev.js - Development Install

```bash
# Standard install (auto build + install)
pnpm install:dev

# Skip build (copy files only)
pnpm install:dev --no-build

# Auto-close and restart Obsidian
pnpm install:dev --kill

# Interactive mode (ask before overwrite)
pnpm install:dev -i

# Reset saved configuration
pnpm install:dev --reset
```

**Workflow**:
1. Automatically executes `pnpm build` (unless `--no-build` is used)
2. Checks required files (main.js, manifest.json, styles.css, binary files)
3. Copies files to Obsidian plugins directory
4. First run prompts for plugins directory path, then remembers it

**After Install**: In Obsidian Settings â†’ Community plugins â†’ Click "Reload" button on Smart Workflow title

---

## Release Process

**Recommended: Use GitHub Actions for automated releases**:

```bash
# 1. Update version numbers (manifest.json and versions.json)

# 2. Commit and create tag
git add .
git commit -m "chore: bump version to x.x.x"
git tag vx.x.x
git push origin vx.x.x

# 3. GitHub Actions will automatically:
#    - Build binaries for all platforms
#    - Package the plugin
#    - Create GitHub Release
```

---

## FAQ

### Missing Binary Files

Running `pnpm install:dev` shows missing `binaries/pty-server-*` files.

**Solution**:
```bash
pnpm build:rust
```

This command automatically detects your current platform and builds the corresponding binary, no need to specify platform parameters.

### Files Locked and Cannot Be Copied

Obsidian is using the PTY server binary file.

> ðŸ’¡ **Tip**: `pnpm install:dev` automatically terminates the PTY server process to release file locks, usually no manual action needed.

If you still encounter file lock issues:
```bash
# Use --kill flag to auto-close Obsidian
pnpm install:dev --kill
```

### Reset Plugin Directory Configuration

Entered wrong plugin directory path on first run.

**Solution**:
```bash
pnpm install:dev --reset
```

---

## Related Documentation

- [PTY Server Documentation](../pty-server/README.md)
- [Main README](../README.md)
- [GitHub Actions Workflow](../.github/workflows/build-rust.yml)
